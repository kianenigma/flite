<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="Runtime API module declares the `trait ParachainHost` which is part of the Runtime API exposed from the Runtime to the Host."><title>polkadot_primitives::runtime_api - Rust</title><script>if(window.location.protocol!=="file:")document.head.insertAdjacentHTML("beforeend","SourceSerif4-Regular-46f98efaafac5295.ttf.woff2,FiraSans-Regular-018c141bf0843ffd.woff2,FiraSans-Medium-8f9a781e4970d388.woff2,SourceCodePro-Regular-562dcc5011b6de7d.ttf.woff2,SourceCodePro-Semibold-d899c5a5c4aeb14a.ttf.woff2".split(",").map(f=>`<link rel="preload" as="font" type="font/woff2" crossorigin href="../../static.files/${f}">`).join(""))</script><link rel="stylesheet" href="../../static.files/normalize-76eba96aa4d2e634.css"><link rel="stylesheet" href="../../static.files/rustdoc-b25d77b18a16a9a4.css"><meta name="rustdoc-vars" data-root-path="../../" data-static-root-path="../../static.files/" data-current-crate="polkadot_primitives" data-themes="" data-resource-suffix="" data-rustdoc-version="1.82.0-nightly (13a52890d 2024-08-14)" data-channel="nightly" data-search-js="search-ef54e092fea9c776.js" data-settings-js="settings-4313503d2e1961c2.js" ><script src="../../static.files/storage-118b08c4c78b968e.js"></script><script defer src="../sidebar-items.js"></script><script defer src="../../static.files/main-cb0df477c2d67d00.js"></script><noscript><link rel="stylesheet" href="../../static.files/noscript-3b12f09e550e0385.css"></noscript><link rel="alternate icon" type="image/png" href="../../static.files/favicon-32x32-422f7d1d52889060.png"><link rel="icon" type="image/svg+xml" href="../../static.files/favicon-2c020d218678b618.svg"></head><body class="rustdoc mod"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="mobile-topbar"><button class="sidebar-menu-toggle" title="show sidebar"></button></nav><nav class="sidebar"><div class="sidebar-crate"><h2><a href="../../polkadot_primitives/index.html">polkadot_<wbr>primitives</a><span class="version">7.0.0</span></h2></div><h2 class="location"><a href="#">Module runtime_<wbr>api</a></h2><div class="sidebar-elems"><section><ul class="block"><li><a href="#traits">Traits</a></li></ul></section><h2><a href="../index.html">In crate polkadot_<wbr>primitives</a></h2></div></nav><div class="sidebar-resizer"></div><main><div class="width-limiter"><rustdoc-search></rustdoc-search><section id="main-content" class="content"><div class="main-heading"><h1>Module <a href="../index.html">polkadot_primitives</a>::<wbr><a class="mod" href="#">runtime_api</a><button id="copy-path" title="Copy item path to clipboard">Copy item path</button></h1><span class="out-of-band"><a class="src" href="../../src/polkadot_primitives/runtime_api.rs.html#17-297">source</a> · <button id="toggle-all-docs" title="collapse all docs">[<span>&#x2212;</span>]</button></span></div><details class="toggle top-doc" open><summary class="hideme"><span>Expand description</span></summary><div class="docblock"><p>Runtime API module declares the <code>trait ParachainHost</code> which is part
of the Runtime API exposed from the Runtime to the Host.</p>
<p>The functions in trait ParachainHost` can be part of the stable API
(which is versioned) or they can be staging (aka unstable/testing
functions).</p>
<p>The separation outlined above is achieved with the versioned API feature
of <code>decl_runtime_apis!</code> and <code>impl_runtime_apis!</code>. Before moving on let’s
see a quick example about how API versioning works.</p>
<h2 id="runtime-api-versioning-crash-course"><a class="doc-anchor" href="#runtime-api-versioning-crash-course">§</a>Runtime API versioning crash course</h2>
<p>The versioning is achieved with the <code>api_version</code> attribute. It can be
placed on:</p>
<ul>
<li>trait declaration - represents the base version of the API.</li>
<li>method declaration (inside a trait declaration) - represents a versioned method, which is not
available in the base version.</li>
<li>trait implementation - represents which version of the API is being implemented.</li>
</ul>
<p>Let’s see a quick example:</p>

<div class="example-wrap"><pre class="rust rust-example-rendered"><code><span class="macro">sp_api::decl_runtime_apis!</span> {
	<span class="attr">#[api_version(<span class="number">2</span>)]
	</span><span class="kw">pub trait </span>MyApi {
		<span class="kw">fn </span>fn1();
		<span class="kw">fn </span>fn2();
		<span class="attr">#[api_version(<span class="number">3</span>)]
		</span><span class="kw">fn </span>fn3();
		<span class="attr">#[api_version(<span class="number">4</span>)]
		</span><span class="kw">fn </span>fn4();
	}
}

<span class="kw">struct </span>Runtime {}

<span class="macro">sp_api::impl_runtime_apis!</span> {
    <span class="attr">#[api_version(<span class="number">3</span>)]
    </span><span class="kw">impl </span><span class="self">self</span>::MyApi&lt;Block&gt; <span class="kw">for </span>Runtime {
        <span class="kw">fn </span>fn1() {}
        <span class="kw">fn </span>fn2() {}
        <span class="kw">fn </span>fn3() {}
    }
}</code></pre></div>
<p>A new API named <code>MyApi</code> is declared with <code>decl_runtime_apis!</code>. The trait declaration
has got an <code>api_version</code> attribute which represents its base version - 2 in this case.</p>
<p>The API has got three methods - <code>fn1</code>, <code>fn2</code>, <code>fn3</code> and <code>fn4</code>. <code>fn3</code> and <code>fn4</code> has got
an <code>api_version</code> attribute which makes them versioned methods. These methods do not exist
in the base version of the API. Behind the scenes the declaration above creates three
runtime APIs:</p>
<ul>
<li><code>MyApiV2</code> with <code>fn1</code> and <code>fn2</code></li>
<li><code>MyApiV3</code> with <code>fn1</code>, <code>fn2</code> and <code>fn3</code>.</li>
<li><code>MyApiV4</code> with <code>fn1</code>, <code>fn2</code>, <code>fn3</code> and <code>fn4</code>.</li>
</ul>
<p>Please note that <code>v4</code> contains all methods from <code>v3</code>, <code>v3</code> all methods from <code>v2</code> and so on.</p>
<p>Back to our example. At the end runtime API is implemented for <code>struct Runtime</code> with
<code>impl_runtime_apis</code> macro. <code>api_version</code> attribute is attached to the <code>impl</code> block which
means that a version different from the base one is being implemented - in our case this
is <code>v3</code>.</p>
<p>This version of the API contains three methods so the <code>impl</code> block has got definitions
for them. Note that <code>fn4</code> is not implemented as it is not part of this version of the API.
<code>impl_runtime_apis</code> generates a default implementation for it calling <code>unimplemented!()</code>.</p>
<p>Hopefully this should be all you need to know in order to use versioned methods in the node.
For more details about how the API versioning works refer to <code>spi_api</code>
documentation <a href="https://docs.substrate.io/rustdocs/latest/sp_api/macro.decl_runtime_apis.html">here</a>.</p>
<h2 id="how-versioned-methods-are-used-for-parachainhost"><a class="doc-anchor" href="#how-versioned-methods-are-used-for-parachainhost">§</a>How versioned methods are used for <code>ParachainHost</code></h2>
<p>Let’s introduce two types of <code>ParachainHost</code> API implementation:</p>
<ul>
<li>stable - used on stable production networks like Polkadot and Kusama. There is only one stable
API at a single point in time.</li>
<li>staging - methods that are ready for production, but will be released on Rococo first. We can
batch together multiple changes and then release all of them to production, by making staging
production (bump base version). We can not change or remove any method in staging after a
release, as this would break Rococo. It should be ok to keep adding methods to staging across
several releases. For experimental methods, you have to keep them on a separate branch until
ready.</li>
</ul>
<p>The stable version of <code>ParachainHost</code> is indicated by the base version of the API. Any staging
method must use <code>api_version</code> attribute so that it is assigned to a specific version of a
staging API. This way in a single declaration one can see what’s the stable version of
<code>ParachainHost</code> and what staging versions/functions are available.</p>
<p>All stable API functions should use primitives from the latest version.
In the time of writing of this document - this is <code>v2</code>. So for example:</p>

<div class="example-wrap ignore"><a href="#" class="tooltip" title="This example is not tested">ⓘ</a><pre class="rust rust-example-rendered"><code><span class="kw">fn </span>validators() -&gt; Vec&lt;v2::ValidatorId&gt;;</code></pre></div>
<p>indicates a function from the stable <code>v2</code> API.</p>
<p>All staging API functions should use primitives from <code>vstaging</code>. They should be clearly
separated from the stable primitives.</p>
</div></details><h2 id="traits" class="section-header">Traits<a href="#traits" class="anchor">§</a></h2><ul class="item-table"><li><div class="item-name"><a class="trait" href="trait.ParachainHost.html" title="trait polkadot_primitives::runtime_api::ParachainHost">Parachain<wbr>Host</a></div><div class="desc docblock-short">The API for querying the state of parachains on-chain.</div></li></ul></section></div></main></body></html>